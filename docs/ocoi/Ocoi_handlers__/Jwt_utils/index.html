<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Jwt_utils (ocoi.Ocoi_handlers__.Jwt_utils)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">ocoi</a> &#x00BB; <a href="../index.html">Ocoi_handlers__</a> &#x00BB; Jwt_utils</nav><h1>Module <code>Ocoi_handlers__.Jwt_utils</code></h1></header><aside><p>Defines utilities for working with <a href="https://jwt.io/introduction/">JWT tokens</a></p><p>Note that <code>algorithm</code> in this code and documentation refers to the JWT algorithm type, which specifies the key used for signatures as well as the choice of algorithm. Instances of it are created with <code>Jwt.HS256 &quot;My secret key&quot;</code>.</p></aside><dl><dt class="spec type" id="type-verify_decode_result"><a href="#type-verify_decode_result" class="anchor"></a><code><span class="keyword">type</span> verify_decode_result</code><code> = </code><table class="variant"><tr id="type-verify_decode_result.Payload" class="anchored"><td class="def constructor"><a href="#type-verify_decode_result.Payload" class="anchor"></a><code>| </code><code><span class="constructor">Payload</span> <span class="keyword">of</span> Jwt.payload</code></td></tr><tr id="type-verify_decode_result.SignatureMismatch" class="anchored"><td class="def constructor"><a href="#type-verify_decode_result.SignatureMismatch" class="anchor"></a><code>| </code><code><span class="constructor">SignatureMismatch</span></code></td></tr><tr id="type-verify_decode_result.FormatError" class="anchored"><td class="def constructor"><a href="#type-verify_decode_result.FormatError" class="anchor"></a><code>| </code><code><span class="constructor">FormatError</span></code></td></tr></table></dt><dd><p>The result from verifying and decoding a JWT token</p><p>Gives the payload of the token if the token was correctly formatted and had a valid signature, <code>SignatureMismatch</code> if it was correctly formatted but did not have the right signature, and <code>FormatError</code> if it was incorrctly formatted.</p></dd></dl><dl><dt class="spec value" id="val-verify"><a href="#val-verify" class="anchor"></a><code><span class="keyword">val</span> verify : <span>algorithm:Jwt.algorithm</span> <span>&#45;&gt;</span> Jwt.t <span>&#45;&gt;</span> Base.bool</code></dt><dd><p><code>verify ~algorithm token</code> checks whether the signature of <code>token</code> is what it should be given the signature algorithm and secret key specified by <code>algorithm</code></p></dd></dl><dl><dt class="spec value" id="val-verify_and_decode"><a href="#val-verify_and_decode" class="anchor"></a><code><span class="keyword">val</span> verify_and_decode : <span>algorithm:Jwt.algorithm</span> <span>&#45;&gt;</span> Base.string <span>&#45;&gt;</span> <a href="index.html#type-verify_decode_result">verify_decode_result</a></code></dt><dd><p><code>verify ~algorithm token_string</code> first parses <code>token_string</code> into a JWT token (or returns <code>FormatError</code> if this can't be done). It then verifies that the signature of the token is what it should be using the details in <code>algorithm</code>, returning the payload of the token if it is and <code>SignatureMismatch</code> otherwise.</p></dd></dl><dl><dt class="spec value" id="val-make_token"><a href="#val-make_token" class="anchor"></a><code><span class="keyword">val</span> make_token : <span>algorithm:Jwt.algorithm</span> <span>&#45;&gt;</span> <span><span>(Base.string * Base.string)</span> Base.list</span> <span>&#45;&gt;</span> Jwt.t</code></dt><dd><p><code>make_token ~algorithm [(key1, value1); (key2, value2); ...]</code> creates a JWT token from a list of claims as key-value tuples using some algorithm.</p></dd></dl><dl><dt class="spec value" id="val-make_and_encode"><a href="#val-make_and_encode" class="anchor"></a><code><span class="keyword">val</span> make_and_encode : <span>algorithm:Jwt.algorithm</span> <span>&#45;&gt;</span> <span><span>(Base.string * Base.string)</span> Base.sexp_list</span> <span>&#45;&gt;</span> Base.string</code></dt><dd><p><code>make_and_encode ~algorithm claims</code> calls <code>make_token ~algorithm claims</code> and encodes the result as a base64 string.</p></dd></dl><dl><dt class="spec value" id="val-get_claim"><a href="#val-get_claim" class="anchor"></a><code><span class="keyword">val</span> get_claim : Base.string <span>&#45;&gt;</span> Jwt.payload <span>&#45;&gt;</span> <span>Base.string Base.option</span></code></dt><dd><p><code>get_claim &quot;claim&quot; payload</code> returns <code>Some v</code> if <code>v</code> is the value associated with <code>&quot;claim&quot;</code> in <code>payload</code> or <code>None</code> if <code>&quot;claim&quot;</code> is not present in the token.</p></dd></dl></div></body></html>