<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Authentication (ocoi.Ocoi.Authentication)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">ocoi</a> &#x00BB; <a href="../index.html">Ocoi</a> &#x00BB; Authentication</nav><h1>Module <code>Ocoi.Authentication</code></h1><p>Implements authentication for requests on a per route basis using the <code>Authorization</code> HTTP header</p><p>Example use:</p><pre><code class="ml">let my_route =
  get &quot;/my_route&quot;
    (Ocoi.Authentication.Checks.accept_all (fun _ -&gt;
         `String &quot;Hello world!&quot; |&gt; respond'))</code></pre><p>implements a very simple kind of &quot;authentication&quot; that accepts all requests to <code>/my_route</code>.</p><p>A more useful example would replace <a href="Checks/index.html#val-accept_all"><code>Ocoi.Authentication.Checks.accept_all</code></a> with some other function with signature <code>auth_credential option -&gt; Request.t -&gt; bool</code> that takes an <code>Authorization</code> head and returns whether it is valid for the associated request. For instance, using JWT tokens for authentication:</p><pre><code class="ml">let jwt_algorithm = Jwt.HS256 &quot;SupaSekretKey&quot;

let check_user jwt_payload req =
  let jwt_user = Jwt.(find_claim (claim &quot;user_id&quot;) jwt_payload) in
  let req_id = param req &quot;id&quot; in
  jwt_user = req_id


let get_user =
  get &quot;/users/:id&quot;
    (Ocoi.Authentication.Checks.jwt_check ~algorithm:jwt_algorithm ~validate:check_user (fun _ -&gt;
         get_user (param req &quot;id&quot;) |&gt; respond'))</code></pre></header><dl><dt class="spec type" id="type-auth_credential"><a href="#type-auth_credential" class="anchor"></a><code><span class="keyword">type</span> auth_credential</code> = <code>[ </code><table class="variant"><tr id="type-auth_credential.Cohttp.Auth.credential" class="anchored"><td class="def type"><a href="#type-auth_credential.Cohttp.Auth.credential" class="anchor"></a><code>| </code><code>Cohttp.Auth.credential</code></td></tr><tr id="type-auth_credential.Bearer" class="anchored"><td class="def constructor"><a href="#type-auth_credential.Bearer" class="anchor"></a><code>| </code><code>`Bearer <span class="keyword">of</span> string</code></td></tr></table><code> ]</code></dt><dd><p>Extends Cohttp authorization header types with Bearer</p></dd></dl><dl><dt class="spec value" id="val-authenticate"><a href="#val-authenticate" class="anchor"></a><code><span class="keyword">val</span> authenticate : <span>check:<span>(<span><a href="index.html#type-auth_credential">auth_credential</a> option</span> <span>&#45;&gt;</span> Opium.Std.Request.t <span>&#45;&gt;</span> bool)</span></span> <span>&#45;&gt;</span> <span>(Opium.Std.Request.t <span>&#45;&gt;</span> <span>Opium.Std.Response.t Lwt.t</span>)</span> <span>&#45;&gt;</span> Opium.Std.Request.t <span>&#45;&gt;</span> <span>Opium.Std.Response.t Lwt.t</span></code></dt><dd><p><code>authenticate ~check handler_body</code> wraps <code>handler_body</code> by using <code>check</code> for authentication</p><p>When called on a request, the new function will parse the <code>Authorization</code> header of the request and call <code>check</code> on that and the request. If this gives <code>true</code> the original handler body will be called. Otherwise an <code>empty 401
    Unauthorized</code> response will be returned.</p></dd></dl><dl><dt class="spec module" id="module-Checks"><a href="#module-Checks" class="anchor"></a><code><span class="keyword">module</span> <a href="Checks/index.html">Checks</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Defines various check functions to be used by <a href="index.html#val-authenticate"><code>authenticate</code></a>.</p></dd></dl></div></body></html>