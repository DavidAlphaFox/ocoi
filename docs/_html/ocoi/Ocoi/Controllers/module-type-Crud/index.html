<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Crud (ocoi.Ocoi.Controllers.Crud)</title><link rel="stylesheet" href="../../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../../index.html">ocoi</a> &#x00BB; <a href="../../index.html">Ocoi</a> &#x00BB; <a href="../index.html">Controllers</a> &#x00BB; Crud</nav><h1>Module type <code>Controllers.Crud</code></h1><p>Represents Create, Read, Update and Delete operations on some model <code>t</code></p><p>Example use: Given a model <code>type t = {id: int; title: string; completed: bool} [@@deriving yojson]</code> defined in <code>models/todo.ml</code> with CRUD functionality for the database implemented in <code>queries/todo.ml</code>, you would define a module in <code>controllers/todo.ml</code> with this signature like so:</p><pre><code class="ml">module Crud : Ocoi.Controllers.Crud = struct
  include Models.Todo

  let create json =
    let open Yojson.Safe.Util in
    let title = json |&gt; member &quot;title&quot; |&gt; to_string in
    let completed = json |&gt; member &quot;completed&quot; |&gt; to_bool in
    Queries.Todo.create conn ~title ~completed

  let index () = Queries.Todo.all conn

  let show id = Queries.Todo.show conn id

  let update {id; title; completed} =
    Queries.Todo.update conn {id; title; completed}

  let destroy id = Queries.Todo.destroy conn id
end</code></pre><p>and then register it <code>main.ml</code> with <code>Ocoi.Controllers.register_crud &quot;/todos&quot; (module Todo.Crud) app</code>. This creates a REST API at <code>/todos</code> and <code>/todos/:id</code> with the expected functionality.</p></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt><dd><p>The model type</p></dd></dl><dl><dt class="spec value" id="val-to_yojson"><a href="#val-to_yojson" class="anchor"></a><code><span class="keyword">val</span> to_yojson : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> Yojson.Safe.t</code></dt><dd><p>Converts the model type to JSON (typically automatically generated with <code>[@@deriving yojson]</code>)</p></dd></dl><dl><dt class="spec value" id="val-of_yojson"><a href="#val-of_yojson" class="anchor"></a><code><span class="keyword">val</span> of_yojson : Yojson.Safe.t <span>&#45;&gt;</span> <span><a href="index.html#type-t">t</a> Ppx_deriving_yojson_runtime.error_or</span></code></dt><dd><p>Produces a model instance from JSON (typically automatically generated with <code>[@@deriving yojson]</code>)</p></dd></dl><dl><dt class="spec value" id="val-create"><a href="#val-create" class="anchor"></a><code><span class="keyword">val</span> create : Yojson.Safe.t <span>&#45;&gt;</span> <span>int Lwt.t</span></code></dt><dd><p><code>create json</code> stores a new model in the database (probably initialised with data from <code>json</code>) and returns its id</p></dd></dl><dl><dt class="spec value" id="val-index"><a href="#val-index" class="anchor"></a><code><span class="keyword">val</span> index : unit <span>&#45;&gt;</span> <span><span><a href="index.html#type-t">t</a> list</span> Lwt.t</span></code></dt><dd><p><code>index ()</code> gets all stored instances of the model</p></dd></dl><dl><dt class="spec value" id="val-show"><a href="#val-show" class="anchor"></a><code><span class="keyword">val</span> show : int <span>&#45;&gt;</span> <span><span><a href="index.html#type-t">t</a> option</span> Lwt.t</span></code></dt><dd><p><code>show id</code> returns <code>Some m</code> if there is some model <code>m</code> with id <code>id</code> stored, and <code>None</code> otherwise</p></dd></dl><dl><dt class="spec value" id="val-update"><a href="#val-update" class="anchor"></a><code><span class="keyword">val</span> update : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p><code>update new_model</code> updates the stored model with the id of <code>new_model</code> to match it</p></dd></dl><dl><dt class="spec value" id="val-destroy"><a href="#val-destroy" class="anchor"></a><code><span class="keyword">val</span> destroy : int <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p><code>destroy id</code> deletes the model with id <code>id</code> from the database</p></dd></dl></div></body></html>